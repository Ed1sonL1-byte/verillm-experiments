# 实验配置文件
experiment:
  name: "VeriLLM Verification Experiments"
  version: "1.0.0"
  description: "基于VeriLLM论文的验证机制实验"
  
  # 运行参数
  runs_per_config: 3  # 每个配置重复3次
  
  # Hidden States采样配置
  hidden_state_sampling:
    method: "every_n_layers"  # 采样方法
    n: 8  # 每隔8层记录一次（论文设置）
    layers: [0, 8, 16, 24, 32]  # 或者指定具体层（可选）
  
  # 统计阈值（论文Section 8.2，adjusted for FP16）
  thresholds:
    Pe: 0.05   # 指数位不匹配率上限
    Pm: 0.75   # 大尾数偏差比例下限（delta > 1e-5）
    Pw: 0.50   # 小尾数偏差比例下限（delta < 1e-7，FP16下放宽）
    mean_epsilon: 0.01  # 平均误差上限
  
  # 输出配置
  output:
    save_hidden_states: false  # 是否保存Hidden States（占用空间大）
    save_generated_text: true  # 是否保存生成文本
    save_statistics: true      # 是否保存统计数据

# 实验1：同构硬件基线
exp1_homogeneous:
  name: "同构硬件基线验证"
  description: "在同一硬件上进行推理和验证，建立误差基线"
  enabled: true
  scenarios:
    - name: "nvidia_nvidia"
      inference_device: "nvidia"
      verification_device: "nvidia"
      inference_model: "full"  # full or quantized
      verification_model: "full"
    - name: "mac_mac"
      inference_device: "mac"
      verification_device: "mac"
      inference_model: "full"
      verification_model: "full"

# 实验2：异构硬件兼容性
exp2_heterogeneous:
  name: "异构硬件兼容性测试"
  description: "跨硬件平台的推理和验证，测试兼容性"
  enabled: true
  scenarios:
    - name: "nvidia_mac"
      inference_device: "nvidia"
      verification_device: "mac"
      inference_model: "full"
      verification_model: "full"
    - name: "mac_nvidia"
      inference_device: "mac"
      verification_device: "nvidia"
      inference_model: "full"
      verification_model: "full"

# 实验3：量化攻击检测（多验证端）
# 推理端使用量化模型，同时在NVIDIA和Mac上用全精度模型验证
exp3_quantization_detection:
  name: "量化攻击检测"
  description: "推理端使用量化模型作弊，NVIDIA和Mac验证端都使用全精度检测"
  enabled: true
  inference:
    device: "nvidia"
    model: "quantized"  # 作弊：用量化模型
  verification:
    - name: "nvidia_verification"
      device: "nvidia"
      model: "full"     # NVIDIA用全精度验证
      expected_result: "REJECT"
    - name: "mac_verification"
      device: "mac"
      model: "full"     # Mac用全精度验证
      expected_result: "REJECT"
  notes: |
    这个实验测试量化模型能否被检测：
    1. Step1: NVIDIA服务器用量化模型做推理，保存hidden states
    2. Step2a: NVIDIA服务器用全精度模型验证（同构）
    3. Step2b: Mac服务器用全精度模型验证（异构）
    预期：两个验证端都应该能检测到量化作弊（REJECT）

# 实验5：懒惰验证者
exp5_lazy_verifier:
  name: "懒惰验证者检测"
  description: "验证者偷懒使用量化模型，测试是否能被发现"
  enabled: true
  scenarios:
    - name: "nvidia_full_nvidia_quantized"
      inference_device: "nvidia"
      verification_device: "nvidia"
      inference_model: "full"
      verification_model: "quantized"  # 验证者偷懒
      expected_result: "REJECT"
    - name: "mac_full_mac_quantized"
      inference_device: "mac"
      verification_device: "mac"
      inference_model: "full"
      verification_model: "quantized"
      expected_result: "REJECT"

# 实验6：多验证者并行
exp6_one_to_many:
  name: "一对多验证"
  description: "一个推理者，多个验证者并行验证"
  enabled: true
  scenarios:
    - name: "nvidia_to_multiple"
      inference_device: "nvidia"
      verification_devices: ["nvidia", "mac", "nvidia"]  # 3个验证者
      num_verifiers: 3
      parallel: true  # 并行执行

# Pe:          mean=0.008982, std=0.009687, p90=0.015625
# Pm:          mean=0.602678, std=0.397146, p50=0.842634
# Pw:          mean=0.397317, std=0.397148, p50=0.157366
# Mean Error:  mean=0.001503, std=0.002839, p95=0.004475
# Accept Rate: mean=0.9884, min=0.9607, max=0.9991